[general]
# Path to the AWSLogs agent's state file. Agent uses this file to maintain
# client side state across its executions.
state_file = <%= node[:cwlogs][:state_file_dir] %>/<%= node[:cwlogs][:state_file_name] %>


## Each log file is defined in its own section. The section name doesn't
## matter as long as its unique within this file.
#
#[kern.log]
#
## Path of log file for the agent to monitor and upload.
#
#file = /var/log/kern.log
#
## Name of the destination log group.
#
#log_group_name = kern.log
#
## Name of the destination log stream.
#
#log_stream_name = {instance_id}
#
## Format specifier for timestamp parsing.
#
#datetime_format = %b %d %H:%M:%S
#

[<%= node[:opsworks][:stack][:name] %>]
datetime_format = [%Y-%m-%d %H:%M:%S]
log_group_name = <%= node[:opsworks][:stack][:name].gsub(' ', '_') %>
file = <%= node[:cwlogs][:logfile] %>
log_stream_name = <%= node[:opsworks][:instance][:hostname] %>

[nginx.error.log]
datetime_format = [%Y/%m/%d %H:%M:%S]
log_group_name = <%= node[:opsworks][:stack][:name].gsub(' ', '_') %>/nginx/error.log
file = <%= node[:nginx][:log_dir] %>/error.log
log_stream_name = <%= node[:opsworks][:instance][:hostname] %>

[nginx.access.log]
datetime_format = [%d/%b/%Y:%H:%M:%S %z]
log_group_name = <%= node[:opsworks][:stack][:name].gsub(' ', '_') %>/nginx/access.log
file = <%= node[:nginx][:log_dir] %>/access.log
log_stream_name = <%= node[:opsworks][:instance][:hostname] %>

<% node[:opsworks][:applications]. each do |app| %>
[nginx.<%= app[:name] %>.access.log]
datetime_format = [%d/%b/%Y:%H:%M:%S %z]
log_group_name = <%= node[:opsworks][:stack][:name].gsub(' ', '_') %>/nginx/<%= app[:name].gsub('-', '_') %>.access.log
file = <%= node[:nginx][:log_dir] %>/<%= app[:name].gsub('-', '_') %>.access.log
log_stream_name = <%= node[:opsworks][:instance][:hostname] %>

<% end %>
